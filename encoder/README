The encoder code is taken from here:
https://forums.raspberrypi.com/viewtopic.php?f=37&t=228886&p=1820348#p1820348
